!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Cpp4Web=e():t.Cpp4Web=e()}(this,(()=>(()=>{"use strict";var t={d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Parse:()=>nt,Runtime:()=>ct,Tokenizer:()=>ut});const s=["int","void","double","float","short","char","bool","long","signed","unsigned","string","asm","do","if","return","typedef","auto","inline","typeid","dynamic_cast","typename","break","else","sizeof","union","case","enum","mutable","static","catch","explicit","namespace","static_cast","using","export","new","struct","virtual","class","extern","operator","switch","const","false","private","template","volatile","const_cast","protected","this","wchar_t","continue","for","public","throw","while","default","friend","register","true","delete","goto","reinterpret_cast","try"],n=["==","<<=",">>=","*=","+=","~=","-=","/=","|=","^=","%=","&=","=","<<",">>","#","::","?",":",">=","<=","<",">","(",")","->","...",'"',"'","!=","++","--","{","}",",","+","-","*","/","~","||","&&","|","&","^","%","!","[","]","."],r=0,i=1,a=2,o=3,u=4,c=5,l=6,h=7,f=0,p=1,y=2,w=3;class d{#t;constructor(t,e){this.#t=t,this.t=e??0,this.error=null,this.i={},this.u={},this.meta={},this.l=new Map,this.stack=[],this.functions=new Map}h(t){if(!this.error){const e=t(this);this.error||(this.u=e.u,this.t=e.t)}return this}p(t){if(!this.error){const e=t(this.copy());if(!e.error)return this.u=e.u,this.t=e.t,!0;this.meta.m=e.error}return!1}S(t){return this.u=t,t&&!t.lineNum&&(t.lineNum=this.k),this}v(t){return t.u=this.u,this}_(t){return this.u={},this.error=t,this}copy(){const t=new d(this.#t,this.t);return t.l=this.l,t.functions=this.functions,t.stack=this.stack,t}A(t){const e=[];for(;!this.empty();){if(!this.p((e=>t(e))))break;e.push(this.u)}return this.u=e,this}reduce(t,e){let s=e;for(;;){if(!this.p((e=>(e.meta.j=s,t(e)))))break;s=this.u}return this.u=s,this}N(t){if(this.error)return this;for(const e of t){const t=e[0],s=e[1],n=e[2];if(t){for(const e of t)if(this.M.content===e&&(this.M.type===o||this.M.type===a)){const t=s(this);return n&&n(this),t}}else{if(this.p((t=>s(t))))return n&&n(this),this}}return this.error=this.meta.m,this.error||(this.error="stop"),this}Z=(t,e,s=!1)=>(this.I(t,e)?(s||(this.u={content:this.M.content,type:t}),this.t++):this.error=`cannot find ${e[0]} at line ${this.k}`,this);O=t=>this.Z(o,t,!0);F=t=>this.Z(o,t);C=()=>this.Z(l,[]);L=()=>this.Z(l,[],!0);U=t=>this.Z(a,t);$=()=>this.Z(i,[]);P=t=>this.Z(r,t);get M(){return this.#t[this.t]}V(t){return this.i[t]}I(t,e){if(this.error)return!1;const s=this.M;return s.type===t&&(0===e.length||-1!==e.indexOf(s.content))}B=t=>this.I(o,t);get k(){return this.t>=this.#t.length?-1:this.#t[this.t].line}empty(){return this.t>=this.#t.length}}const m=t=>{const e=t.P([]).u,s=t.l.get(e?.content);return s?t.S({type:0,T:s,content:e.content}):(t.error=`${e?.content} is not a varibale`,t)},b=t=>{const e=t.$().u;return t.S({type:18,content:e.content}),t},g=t=>{let e={u:{type:19}};return t.h(j).v(e).S({type:26,content:e.u})},S=(t,e)=>s=>{const n=s.h(e).u;return s.reduce((s=>{const n={},r={};return s.F(t).v(n).h(e).v(r).S({type:1,sign:n.u.content,content:[s.meta.j,r.u]})}),n)},k=t=>{const e=t.U(["true","false"]).u.content;return t.S({type:18,content:"true"===e?"1":"0"})},x=t=>{const e=t.Z(u,[]).u.content;return t.S({type:23,content:e})},v=t=>{const e=t.Z(h,[]).u.content;return t.S({type:23,content:e})},_=t=>{const e={};t.N([[null,t=>t.P([])],[null,t=>t.Z(c,[])]]).v(e);const s=e.u?.content,n=e.u?.type;if(!t.functions.get(s)&&16===n)return t.error=`${s} is not a function`,t;const r=t.O(["("]).A((t=>(t.h(B),t.B([")"])||t.O([","]),t))).O([")"]).u;return t.S({type:n===c?15:16,functionName:s,argus:r}),t},A=t=>t.N([[["("],t=>t.O(["("]).h(E).O([")"])],[["true","false"],k],[null,b],[null,m],[null,_],[null,x],[null,v]]),T=t=>e=>{const s={u:{type:19}},n={u:{type:19}};return e.N([[["["],e=>e.O(["["]).h(E).v(s).O(["]"]).h(T(t)).v(n).S({type:3,inner:n.u,t:s.u})],[null,e=>e.S(t)]])},z=t=>e=>{const s={u:{type:19}},n={u:{type:19}};return e.N([[["["],e=>e.h((e=>3!==t.type?e._("type error"):e)).O(["["]).h(E).v(s).O(["]"]).h(z(t)).v(n).S({type:2,inner:n.u,t:s.u})],[["."],e=>e.h((t=>t)).O(["["]).h(E).v(s).O(["]"]).h(z(t)).v(n).S({type:2,inner:n.u,t:s.u})],[null,t=>t.S(null)]])},j=t=>{const e={u:{type:19}};return t.h(A).v(e).h((s=>{let n=e.u;if(0===n.type){const e=n.T;t.h(((t,e)=>s=>{if(3===t.type){const n={u:{type:19}};s.h(z(t)).v(n).S({type:25,sign:n.u,content:e})}else"struct"===t.type?console.info(t):s.S(e);return s})(e,n)).v(n)}return t.p((t=>t.F(["++","--"])))&&t.S({type:25,sign:t.u.content,content:n.u}),s}))},N=t=>{const e=["++","--","+","-","~","!","*","&"],s={u:{type:19}},n={u:{type:19}};return t.N([[e,t=>t.F(e).v(s).h(N).v(n).S({type:4,sign:s.u.content,content:n.u})],[null,j]])},M=t=>t.h(S(["*","/","%"],N)),Z=t=>t.h(S(["+","-"],M)),I=t=>t.h(S(["<<",">>"],Z)),O=t=>t.h(S(["<",">","<=",">="],I)),F=t=>t.h(S(["==","!="],O)),C=t=>t.h(S(["&"],F)),L=t=>t.h(S(["^"],C)),U=t=>t.h(S(["|"],L)),$=t=>t.h(S(["&&"],U)),P=t=>t.h(S(["||"],$)),V=t=>{const e=t.h(P).u;t.p((t=>{const s=t.O(["?"]).h(E).O([":"]).u,n=t.h(E).u;return t.S({type:5,sign:"?",content:[e,s,n]})}));return t},B=t=>{const e=t.A((t=>{const e={},s={};return t.h(g).v(e).F(n.slice(1,13)).v(s).S({type:1,sign:s.u.content,content:[e.u]})})).u,s=t.h(V).u;if(e.length){for(let t=0;t<e.length-1;t++)e[t].content.push(e[t+1]);e[e.length-1].content.push(s),t.S(e[0])}return t},E=t=>{let e=t.h(B).u;for(;t.B([","]);)t.F([","]),e={type:1,sign:",",content:[e,t.h(B).u]};return t.S(e),t},R=t=>t.h(E).L(),W=t=>t.V(t.M.content)?t.P([]).S({type:20,T:{type:22,name:t.M.content}}):t._("not struct"),q=t=>{const e=s.slice(0,11),n={};return t.N([[e,t=>t.U(e).v(n).S({type:20,T:{type:21,name:n.u}})],[null,W]])},D=t=>{const e=t.h(q).u?.T,s={u:{type:19}};return t.A((t=>{let s=t.P([]).u;const n=t.h(T(e)).u;let r=null;return t.B(["="])&&(r=t.O(["="]).h(V).u),t.B([","])&&t.O([","]),t.S([s,r,n]),t})).v(s).h((e=>{if(e.B(["("]))return e._("not variable");return s.u.forEach((e=>{t.l.set(e[0].content,e[2]),t.stack.push(e[0].content)})),e})).S({type:6,content:s.u})},H=t=>{const e={},s={},n={},r={},i=t.M.line;return t.U(["for"]).O(["("]).N([[null,R],[null,D]]).L().v(e).h(E).L().v(s).h(E).v(n).O([")"]).N([[null,et],[null,tt]]).v(r).S({type:7,initial:e.u,condition:s.u,increment:n.u,body:r.u,lineNum:i})},K=t=>{const e={},s={},n=t.M.line;return t.U(["while"]).O(["("]).h(E).v(e).O([")"]).N([[["{"],et],[null,tt]]).v(s).S({type:17,condition:e.u,body:s.u,lineNum:n})},X=t=>{const e={u:{type:19}},s={u:{type:19}};return t.U(["do"]).h(et).v(s).U(["while"]).O(["("]).h(E).v(e).S({type:8,condition:e.u,body:s.u})},G=t=>{const e={},s={},n={},r={},i=t.M.line;return t.U(["if"]).O(["("]).h(E).O([")"]).v(e).N([[["{"],et],[null,tt]]).v(s).A((t=>{const e={},s={};return t.U(["else"]).U(["if"]).O(["("]).h(E).v(e).O([")"]).h(et).v(s).S({condition:e.u,body:s.u})})).v(n).A((t=>t.U(["else"]).N([[["{"],et],[null,tt]]))).v(r).S({type:24,condition:e.u,body:s.u,elif:n.u,elses:r.u[0],lineNum:i})},J=t=>t.U(["break"]).S({type:9}).L(),Q=t=>t.U(["continue"]).S({type:10}).L(),Y=t=>{const e={u:{type:19}};return t.U(["return"]).h(E).v(e).S({type:11,content:e.u}).L()},tt=t=>t.N([[["for"],H],[["while"],K],[["do"],X],[["if"],G],[["break"],J],[["continue"],Q],[["return"],Y],[null,R],[null,t=>D(t).L()]]),et=t=>{t.stack.push("{");const e=t.M.line,s=t.O(["{"]).A(tt).O(["}"]).u;for(s.lineNum=e;"{"!=t.stack[t.stack.length-1];)t.l.delete(t.stack[t.stack.length-1]),t.stack.pop();return t.stack.pop(),t.S({type:12,content:s})},st=t=>{const e={u:{type:19}},s={u:{type:19}},n={u:{type:19}},r={u:{type:19}};let i="";return t.h(q).v(e).P([]).v(s).h((e=>(i=s.u.content,t.functions.set(i,{}),e))).O(["("]).A((e=>{if(e.B([")"]))return e._("end");const s=e.h(q).u?.T,n=e.P([]).u;return t.l.set(n.content,s),t.stack.push(n.content),e.u={type:s,variable:n},e.B([")"])||e.O([","]),e})).O([")"]).v(r).h(et).v(n).h((e=>(e.functions.set(i,t.u),e))).S({type:13,functionName:i,returnType:e.u,parameters:r.u,body:n.u})},nt=t=>{const e=new d(t),s=(t=>{const e=[],s=new Map;return t.A((t=>t.N([[null,t=>D(t).L(),t=>{e.push(t.u)}],[null,st,t=>{s.set(t.u.functionName,t.u)}]]))).h((t=>(t.empty()||t._(t.meta.m),t))).S({type:14,globals:e,functions:s,main:t.functions.get("main"),structs:null})})(e).u;if(e.error)throw e.error;return s},rt="\nvoid puts(string out) {\n    @output(out);\n}\n\nvoid printf(string out) {\n    @outputWithFormat( @arguments() );\n}\n\n",it=t=>{const e=/^((\d+\.\d*|\.\d+|\d+)([eE][-+]?\d+)?[lLuU]*)|^(0[xX][0-9a-fA-F]+[lLuU]*)|^(0[0-7]+[lLuU]*)/;if(t.startsWith(";"))return{type:l,content:";",len:1};if(t.startsWith('"'))for(let e=1;e<t.length;e++)if('"'==t[e]&&"\\"!=t[e-1]){let s=t.slice(1,e).replaceAll();return{type:u,content:s,len:e+1}}if(t.startsWith("'"))return{type:h,content:t[1],len:3};if(t.startsWith("#"))return{type:"preCompile",len:1};if(t.startsWith("/*"))return{type:"comment",content:"/*",len:2};if(/^[\s]+/.test(t)){const e=t.match(/^[\s]+/);return{type:"whiteSpace",content:e,len:e.length}}if(t.startsWith("//"))return{type:"comment",content:"//",len:t.length};if(e.test(t)){const s=t.match(e)[0];return{type:i,content:s,len:s.length}}if(/^[_a-zA-Z][_a-zA-Z0-9]*/.test(t)){const e=t.match(/^[_a-zA-Z][_a-zA-Z0-9]*/)[0];return-1!==s.indexOf(e)?{type:a,content:e,len:e.length}:{type:r,content:e,len:e.length}}if(/^\@[_a-zA-Z][_a-zA-Z0-9]*/.test(t)){const e=t.match(/^\@[_a-zA-Z][_a-zA-Z0-9]*/)[0];return{type:c,content:e,len:e.length}}for(const e of n)if(t.startsWith(e))return{type:o,content:e,len:e.length}},at=t=>{for(;""!==t.line;){if(t.R){let e=1;for(;e<t.line.length;e++)if("/"==t.line[e]&&"*"==t.line[e-1]){t.R=!1;break}if(t.line=t.line.slice(e+1),""===t.line)break}const e=it(t.line);if("preCompile"==e.type)return 1;const s=e;"whiteSpace"!=s.type&&"comment"!=s.type?(s.line=t.lineNum,t.stream.push(s)):"/*"===s.content&&(t.R=!0),t.line=t.line.slice(e.len)}return 0},ot=(t,e)=>{let s=0;switch(t[s].content){case"include":s++,"<"==t[s].content&&s++;const n={lineNum:1,R:!1,stream:e},r={cstdio:rt,stdio:rt}[t[s].content].split("\n");for(const t of r)n.line=t,at(n);return;case"define":return void s++}},ut=t=>{const e=t.split("\n"),s={lineNum:1,R:!1,stream:[]};for(const t of e){s.line=t;if(at(s)){const t=s.stream;s.stream=[],s.line=s.line.slice(1),at(s),ot(s.stream,t),s.stream=t}s.lineNum++}return s.stream};class ct{constructor(t){this.AST=t,this.output="",this.stack={arr:[]},this.symbolTable=new Map,this.stack=[],this.globalVariables=new Map}async setValue(t,e){let s=t.content;if(25===t.type){s=s.content;let n=this.symbolTable.get(s),r=t.sign;for(;null!==r.inner;){n=n[(await this.W(r.t)).result],r=r.inner}n[(await this.W(r.t)).result]=e}else this.symbolTable.set(s,e)}binaryOp(t,e,s){switch(s){case"+":return t.result+e.result;case"-":return t.result-e.result;case"*":return t.result*e.result;case"/":return t.result/e.result;case"%":return t.result%e.result;case"<<":return t.result<<e.result;case">>":return t.result>>e.result;case"^":return t.result^e.result;case"|":return t.result|e.result;case"||":return t.result||e.result;case"&&":return t.result&&e.result;case"&":return t.result&e.result;case"<":return t.result<e.result?1:0;case">":return t.result>e.result?1:0;case"<=":return t.result<=e.result?1:0;case">=":return t.result>=e.result?1:0;case"=":return this.setValue(t.result,e.result),e.result;case"==":return t.result==e.result?1:0}}async q(t){await this.W(t.initial);let e=await this.W(t.condition),s=null,n={controllState:f};for(;0!=e.result;){const{state:r,result:i}=await this.W(t.body);if(r.controllState==w&&(s=i),r.controllState==w||r.controllState==y){n=r;break}await this.W(t.increment),e=await this.W(t.condition)}return n.controllState!=y&&n.controllState!=p||(n.controllState=f),{result:s,state:n}}async D(t){let e=this.globalVariables.get(t.content);return e=this.symbolTable.get(t.content),{result:e,state:{controllState:f}}}async H(t){switch(t.functionName){case"@output":for(const e of t.argus){const{result:t}=await this.W(e);this.output+=t}break;case"@arguments":return{result:this.symbolTable.get("@arguments")};case"@outputWithFormat":{const{result:e}=await this.W(t.argus[0]),s=e;let n=s[0];for(let t=1;t<s.length;t++)n=n.replace("%d",s[t]);this.output+=n}}return{result:null,state:{controllState:f}}}async K(t){for(const e of t.globals)await this.W(e);this.globalVariables=this.symbolTable,this.structs=t.structs,this.functionTable=t.functions;const{state:e}=await this.W(t.main);return{result:null,state:e}}async X(t){this.stack.push("block");let e={controllState:f},s=null;for(const n of t.content){const{result:t,state:r}=await this.W(n);if(r.controllState==w&&(s=t),r.controllState!=f){e=r;break}}for(;;){const t=this.stack.pop();if("block"==t)break;this.symbolTable.delete(t)}return{result:s,state:e}}async G(t,e){this.stack.push(t.functionName);const s=t.parameters,n=this.symbolTable;this.symbolTable=new Map,this.symbolTable.set("@arguments",e);for(let n=0;n<s.length;n++){const r=s[n].variable.content;if("..."===r)break;this.stack.push(t.functionName),this.symbolTable.set(r,e[n])}const{state:r,result:i}=await this.W(t.body);for(;;){const e=this.stack.pop();if(e==t.functionName)break;this.symbolTable.delete(e)}return this.symbolTable=n,r.controllState=f,{result:i,state:r}}async J(t){const{result:e}=await this.W(t.content);return{result:e,state:{controllState:w}}}async Y(t){const e=this.functionTable.get(t.functionName),s=[];for(const e of t.argus){const{result:t,state:n}=await this.W(e);s.push(t)}const{result:n,state:r}=await this.W(e,s);return{result:n,state:r}}async getType(t){if(3==t.type){const e=(await this.W(t.t)).result,s=[];for(let n=0;n<e;n++)s.push(await this.getType(t.inner));return s}if(21==t.type)return 0}async tt(t){const e=t.content.content;let s=t.sign;let n=this.symbolTable.get(e);for(;s;){n=n[(await this.W(s.t)).result],s=s.inner}return{result:n,state:{controllState:f}}}async et(t){for(const e of t.content){const t=e[2],s=e[0].content,n=await this.getType(t);if(e[1]){const t=await this.W(e[1]);this.symbolTable.set(s,t.result)}else this.symbolTable.set(s,n);this.stack.push(s)}return{result:null,state:{controllState:f}}}async st(t,e){switch(this.config&&this.config.debug&&this.k!=t.lineNum&&-1!=t.lineNum&&12!=t.type&&(this.k=t.lineNum,await this.config.debugCallback({currentNode:t,symbolTable:this.symbolTable,stack:this.stack,output:this.output,globalVariables:this.globalVariables})),t.type){case 14:return this.K(t);case 13:return this.G(t,e);case 15:return this.H(t);case 11:return this.J(t);case 23:return{result:t.content,state:{controllState:f}};case 16:return this.Y(t);case 9:return{result:null,state:{controllState:y}};case 10:return{result:null,state:{controllState:p}};case 12:case 3:return this.X(t);case 2:return this.tt(t);case 1:{const e=await this.W(t.content[0]),s=await this.W(t.content[1]);return{result:this.binaryOp(e,s,t.sign),state:{controllState:f}}}case 18:return{result:parseInt(t.content),state:{controllState:f}};case 6:return this.et(t);case 0:return this.D(t);case 26:return{result:t.content,state:{controllState:f}};case 26:{const{state:e,result:s}=await this.W(t.name);let n=s;for(const e of t.arr){const{state:t,result:s}=await this.W(e);n=n[s]}return{result:n,state:e}}case 24:if(0!=(await this.W(t.condition)).result)return this.W(t.body);if(t.elif)for(const e of t.elif){if(0!=(await this.W(e.condition)).result)return this.W(e.body)}if(t.elses)return this.W(t.elses);case 17:{let e=await this.W(t.condition),s={controllState:f},n=null;for(;0!=e.result;){const{state:r,result:i}=await this.W(t.body);if(s=r,r.controllState==w&&(n=i),r.controllState==w||r.controllState==y)break;e=await this.W(t.condition)}return s.controllState!=y&&s.controllState!=p||(s.controllState=f),{result:n,state:s}}case 7:return this.q(t);case 25:if("++"==t.sign){const e=await this.W(t.content);return this.setValue(t.content,e.result+1),{result:e.result,state:e.state}}if("--"==t.sign){const e=await this.W(t.content);return this.setValue(t.content,e.result-1),{result:e.result,state:e.state}}return this.tt(t);case 4:if("++"==t.sign){const e=await this.W(t.content);return this.symbolTable.set(t.content.content,e.result+1),{result:e.result,state:e.state}}if("--"==t.sign){const e=await this.W(t.content);return this.symbolTable.set(t.content.content,e.result-1),{result:e.result,state:e.state}}if("-"==t.sign){const e=await this.W(t.content);return{result:-e.result,state:e.state}}if("+"==t.sign){const e=await this.W(t.content);return{result:e.result,state:e.state}}case 5:if("?"==t.sign){if((await this.W(t.content[0])).result>0){const e=await this.W(t.content[1]);return{result:e.result,state:e.state}}{const e=await this.W(t.content[2]);return{result:e.result,state:e.state}}}}}async W(t,e){return this.st(t,e)}async launch(t,e){return e||(this.config={}),this.config=e,this.input=t,this.k=0,await this.K(this.AST),{output:this.output.replaceAll("\\n","\n")}}}return e})()));